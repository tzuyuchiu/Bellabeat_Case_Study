---
title: "Bellabeat Case Study in R"
author: "Tzu Yu Chiu"
date: "2023-10-04"
output: html_document
---

### Introduction
#### About the company
Bellabeat, a technology company with a strong focus on health, was co-founded by Urška Sršen and Sando Mur. Leveraging her artistic background, Sršen played a pivotal role in crafting elegantly designed tech solutions that serve as a source of information and inspiration for women across the globe. By gathering data related to activity, sleep, stress, and reproductive health, Bellabeat has effectively equipped women with valuable insights into their personal well-being and lifestyle patterns.

#### Data
This dataset generated by respondents to a distributed survey via Amazon Mechanical Turk between 04.12.2016-05.12.2016.It can be found on [Kaggle](https://www.kaggle.com/datasets/arashnic/fitbit). 

### Research Questions
The primary objective of this case study is to conduct a comprehensive data analysis, with the overarching goal of identifying promising growth opportunities and formulating precise recommendations. These recommendations are specifically designed to enhance Bellabeat's marketing strategy, and they are grounded in the latest trends pertaining to the utilization of smart devices.

1. What are some trends in smart device usage?

2. How could these trends apply to Bellabeat customers?

3. How could these trends help influence Bellabeat marketing strategy?

### Loading packages
```{r load packages, echo=TRUE}
library(tidyverse)
library(lubridate)
library(ggplot2)
library(dplyr)
```
### Importing datasets
```{r datasets importing,message=FALSE}
daily_activity <- read_csv("/Users/tzuyuchiu/Desktop/Google Data Analystic/case_study/Bellabeat/project/Bellabeat_Case_Study/fitabase_data/dailyActivity_merged.csv")
daily_sleep <- read_csv("/Users/tzuyuchiu/Desktop/Google Data Analystic/case_study/Bellabeat/project/Bellabeat_Case_Study/fitabase_data/sleepDay_merged.csv")
weight_log <-read_csv("/Users/tzuyuchiu/Desktop/Google Data Analystic/case_study/Bellabeat/project/Bellabeat_Case_Study/fitabase_data/weightLogInfo_merged.csv")


```
### Exploring datasets
```{r}
# Check how many users in each datasets
n_distinct(daily_activity$Id)
n_distinct(daily_sleep$Id)
n_distinct(weight_log$Id)
```
There is 33 users in the daily activity data sets, 24 in the daily sleep and only 8 in the weight_log data set. Given that the data comprises only 8 users during the short time period, it is insufficient to draw any meaningful recommendations or conclusions.



```{r warning = FALSE}
# high-level overview of dataset
head(daily_activity)
head(daily_sleep)
head(weight_log)
```
We can see that the format of date columns for each datasets are not aligned and the datatype are strings instead of date

```{r fixing date formats ,warning = FALSE}
# Convert datatype from string to date 
# activity
daily_activity$ActivityDate <- mdy(daily_activity$ActivityDate)
head(daily_activity)

# sleep
daily_sleep_split<- separate(daily_sleep, SleepDay, into=c('ActivityDate','time', 'am_pm'), sep=" ", remove=TRUE)
daily_sleep_split$ActivityDate <- mdy(daily_sleep_split$ActivityDate)
head(daily_sleep_split)

# weight_log
weight_log_split<- separate(weight_log, Date, into=c('ActivityDate','time', 'am_pm'), sep=" ", remove=TRUE)
weight_log_split$ActivityDate <- mdy(weight_log_split$ActivityDate)
head(weight_log_split)
```

After fixed date columns in each dataset, let's check the statistic summary

```{r warning = FALSE}
# Explore and summarize data
daily_activity %>% 
  dplyr::select(ActivityDate,TotalSteps,TotalDistance,Calories,VeryActiveMinutes,FairlyActiveMinutes,LightlyActiveMinutes,SedentaryMinutes) %>%
  summary()
  
daily_sleep_split %>% 
  dplyr::select(ActivityDate,TotalMinutesAsleep,TotalTimeInBed) %>% 
  summary()

weight_log_split %>%
  dplyr::select(ActivityDate,WeightKg,BMI) %>% 
  summary()
```

The statistical summary reveals a noteworthy concern regarding Sedentary Minutes, where the average is very high at 991 minutes. It is imperative that we conduct an in-depth analysis of this particular metric.

### Merging data
Before going the analysis part, I want to merge two datasets: Activity and Sleep by using Id and ActivityDate columns
```{r}
# Merge Daily activity and sleep dataset (full join)

jointdataset <- daily_activity %>% full_join(daily_sleep_split, by=c('Id'='Id', 'ActivityDate'='ActivityDate'))
n_distinct(jointdataset$Id)
```

Since we combined two datasets, I want to check if all the activities sum up is equal to 24 hours (day)
```{r warning = FALSE}
# To check if all the activities sum up is equal to 24 hours (day)
jointdataset <-jointdataset %>% 
  mutate(TotalTime=(VeryActiveMinutes+FairlyActiveMinutes+LightlyActiveMinutes+SedentaryMinutes+TotalTimeInBed)/60)
#filter on days that is not 24 hours in total. 
jointdataset %>% 
  filter(TotalTime > 24) %>% 
  str()

jointdataset %>% 
  filter(TotalTime < 24) %>% 
  str()
```

Going back to the issue found earlier on the Sedentary Minutes. It seems that the sedentary minutes already included the TotolBedTime since after recalculated the TotalTime we have many rows more than 24 hours.

Let's do another check to confirm the assumption
```{r warning = FALSE}
jointdataset_check1 <-jointdataset %>%
  mutate(TotalTime1=(VeryActiveMinutes+FairlyActiveMinutes+LightlyActiveMinutes+SedentaryMinutes)/60)

jointdataset_check1 %>% 
  filter(TotalTime1 > 24) %>% 
  str()

jointdataset_check1 %>% 
  filter(TotalTime1 < 24) %>% 
  str()
```
After eliminating the TotalTimeInBed from the TotalTime column, we no longer have any instances exceeding 24 hours. However, it's important to note that numerous rows still indicate a total time of less than 24 hours. This suggests that, since sedentary minutes encompass the time spent in bed, some users might not be wearing the device while sleeping or resting in bed.

### Performing Analysis
What smart device usage trends can we identify during the week? Specifically, are there any distinctions between weekdays and weekends?
```{r}
# Replace on Totalminsalseep and total time in bed NA to zero 
jointdataset_check1["TotalTimeInBed"][is.na(jointdataset_check1["TotalTimeInBed"])] <- 0
jointdataset_check1["TotalMinutesAsleep"][is.na(jointdataset_check1["TotalMinutesAsleep"])] <- 0
```

```{r}
# Added a column to convert date to day
jointdataset_check1$WeekDay <- weekdays(jointdataset_check1$ActivityDate)
jointdataset_check1$WeekDay <- factor(jointdataset_check1$WeekDay, level=c("Sunday", "Monday","Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"))
# summarize average total steps, total distance, and calories by day
weekday_avg<-jointdataset_check1 %>% 
  group_by(WeekDay) %>% 
  summarise(nb_day=n(),avg_steps = mean(TotalSteps),avg_distance=mean(TotalDistance),avg_calories=mean(Calories)) %>% 
  arrange(WeekDay)
weekday_avg
```

```{r warning = FALSE}
# Trend between number of steps and distance

ggplot(weekday_avg, aes(x=WeekDay)) +
  
  geom_line( aes(y=avg_steps), linewidth=2,group=1, color="blue") + 
  geom_line( aes(y=avg_distance/0.001), linewidth=2,group=1, color="purple") +
  
  scale_y_continuous(
    
    # Features of the first axis
    name = "Total steps",
    
    # Add a second axis and specify its features
    sec.axis = sec_axis(~.*0.0005, name="Distance (km)")) + theme_bw() + 
    labs(title="Fitbit Activity: Number of steps vs. Distance (km)",x="Days")

```

I've noticed a consistent pattern between Total Steps and Distance, which aligns with the logical expectation that increased user movement results in greater distances covered. Furthermore, the chart reveals an intriguing observation: users exhibited higher activity levels on both Tuesday and Saturday compared to the remaining days of the week. Conversely, despite having more observations, users appeared to be less active on Wednesday through Friday.  


```{r warning = FALSE}
# Trend between Total steps and calorie burned

ggplot(weekday_avg, aes(x=WeekDay)) +
  
  geom_line( aes(y=avg_steps), linewidth=1.5,group=1, color="blue") + 
  geom_line( aes(y=avg_calories/0.3), linewidth=1.5,group=1, color="orange") +
  
  scale_y_continuous(
    
    # Features of the first axis
    name = "Number of steps",
    
    # Add a second axis and specify its features
    sec.axis = sec_axis(~.*0.3, name="Calories (kcal)")) +
  theme_bw()+ labs(title="Fitbit Activity:Total steps vs. Calorie burned",
  x="Days")
```

We also observe a consistent trend between Total Steps and Calories Burned, which is in line with the expected outcome that higher user activity leads to increased calorie expenditure.

Moving forward, we will categorize the activities based on their percentage of total distance into four groups: Active, Moderate, Light, and Barely Moving.

```{r}
# Add columns of activities percentage of total distance
jointdataset_check1<-jointdataset_check1 %>% 
  mutate(TotalDistance_calc=(VeryActiveDistance+ModeratelyActiveDistance+LightActiveDistance+SedentaryActiveDistance),
        per_veryactive_distance=ifelse(VeryActiveDistance!=0,VeryActiveDistance/TotalDistance_calc,0),
        per_moderateactive_distance=ifelse(ModeratelyActiveDistance!=0,ModeratelyActiveDistance/TotalDistance_calc,0),
        per_lightactive_distance=ifelse(LightActiveDistance!=0,LightActiveDistance/TotalDistance_calc,0),
        per_sedentaryactive_distance=ifelse(SedentaryActiveDistance!=0,SedentaryActiveDistance/TotalDistance_calc,0))
```


```{r}
# Add a column: category to categorize the activity level into four group - Active, Moderate, Light, and Barely moving 
jointdataset_check1<-jointdataset_check1 %>% 
  mutate(category=case_when(
    per_veryactive_distance>=0.5 ~ "Active",
    per_moderateactive_distance>=0.5 ~ "Moderate",
    per_lightactive_distance>=0.5  ~ "Light",
    per_veryactive_distance+per_moderateactive_distance+per_lightactive_distance<=0.05  ~ "Barely moving",
    .default = "Light"))
```


```{r warning = FALSE}
ggplot(data=jointdataset_check1, aes(x=TotalSteps, y= Calories)) +
  geom_point(aes(color=category)) +
  facet_wrap(~category) + theme_bw()+ labs(title="Total steps vs. Calorie burned by Activity level",
  x="TotalSteps")
```

We observe a positive correlation between calories and total steps for the Active and Light activity levels. However, there is an anomaly where the record with the highest total steps does not correspond to the highest calories burned. In the Moderate category, the dataset is too limited to discern a clear trend. Regarding the Barely Moving category, we notice some unusual patterns: many records have zero total steps but show calories burned, or they display both total steps and calories burned but do not fit into the Active, Moderate, or Light Active distance categories.

```{r warning = FALSE}
ggplot(jointdataset_check1, aes(x = WeekDay, fill = category)) + 
  geom_bar(position = 'dodge') + theme_bw()+ labs(title="Number of records by Activity level",
  x="Days", y="Number of records")
```
Most of users are doing Light activity.

```{r warning = FALSE}
# Summary by category and average calorie burn
category_by_calories <- jointdataset_check1 %>% 
  group_by(category) %>%
  summarise(avg_calories = mean(Calories)) %>%
  ungroup()
```

```{r warning = FALSE}
ggplot(category_by_calories, aes(x = category, y = avg_calories)) + 
  geom_bar(stat = 'identity', width = 0.5, fill = 'firebrick') + theme_bw()+ labs(title="Average Calorie Burn vs Activity level",
  x="Active Level", y="Average Calorie Burn")
```

The Active category exhibits a higher calorie burn, while the Barely Moving category displays lower calorie expenditure. 


I plan to investigate the "Barely Moving" category more closely because of some peculiar records—specifically, those with zero total steps and distance but showing calorie burn. Based on the summary below, it's likely that the smart device assigned these records to the Sedentary activity category. 
```{r warning = FALSE}
# Filter category : Barely moving
barely_move_details <-jointdataset_check1 %>% 
  filter(category=='Barely moving')
# group by Id and show summary for some columns
barely_move_details %>% 
  group_by(ActivityDate) %>% 
  dplyr::select(ActivityDate,TotalSteps,Calories,SedentaryActiveDistance,SedentaryMinutes)
```

Now, let's focus on Sedentary activity.
Typically, walking less than 5,000 steps a day is categorized as sedentary. However, our analysis has revealed that some records with over 5,000 steps per day are still classified as Sedentary activity. Hence, it may be necessary for the company to reconsider and redefine Sedentary Activity on the device.
Additional insights on Sedentary Activity can be found below.
We can find more information regarding Sedentary Activity as following
[UTSouthewstern Medical Center](https://utswmed.org/medblog/how-many-steps-per-day/#:~:text=Walking%20less%20than%205%2C000%20steps%20each%20day%20is%20considered%20sedentary) and
[CNN Health]( https://edition.cnn.com/2023/08/08/health/steps-live-longer-wellness/index.html)

```{r warning = FALSE}
barely_move_details %>% 
  filter(TotalSteps>5000) %>% 
  group_by(ActivityDate) %>% 
  dplyr::select(ActivityDate,TotalSteps,Calories,SedentaryActiveDistance,SedentaryMinutes)
```

### Conclusion and Suggestion

To sum it up, Bellabeat's collection of data related to activity, sleep, stress, and reproductive health has really helped women understand their health and daily routines better. After looking at the FitBit Fitness Tracker Data in detail, I've found some important insights that could make Bellabeat's marketing strategy even better:

1. People tend to be more active on weekends. Bellabeat could encourage users to be active during the week too, maybe with small exercises in the morning or after work.

2. It is advisable for Bellabeat to reconsider its definition of Sedentary activity within the app and separate it from TotalTimeInBed to provide more accurate insights.

3. Bellabeat could expand its functionality to include sleep tracking features, including sleep duration and quality. This would incentivize users to wear the device consistently, even during sleep.

4. Since the majority of users engage in Light Activity, the app could recommend programs focused on weight control and provide information on the calorie burn associated with each exercise. This would serve as an encouragement for users to partake in more physical activities.

These suggestions, based on the analysis of FitBit Fitness Tracker Data, could help Bellabeat improve its marketing strategy and engage users more effectively.



